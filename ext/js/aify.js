/*!
 * 
 *   @xprilion/aifyjs v0.2.0
 *   https://github.com/xprilion/aifyjs
 * 
 *   Copyright (c) Anubhav Singh (https://github.com/xprilion)
 * 
 *   This source code is licensed under the MIT license found in the
 *   LICENSE file in the root directory of this source tree.
 * 
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.aify=t():e.aify=t()}(window,(function(){return function(e){var t={};function n(a){if(t[a])return t[a].exports;var o=t[a]={i:a,l:!1,exports:{}};return e[a].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(a,o,function(t){return e[t]}.bind(null,o));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);n(1);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}window.aifyjs=function e(){var t=this;(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),a(this,"goDialogFlow",(function(e){var t=this;$.ajax({type:"POST",url:"https://aifybot-jshimk.gateway.dialogflow.cloud.ushakov.co",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({session:"test",queryInput:{text:{text:e,languageCode:"en"}}}),success:function(e){var n=e.queryResult.intent.displayName;switch(console.log("Matched Intent: "+n),n){case"PageInfo":t.describePage();break;case"PageSummary":t.readSummary();break;case"PageLinks":t.getPageLinks();break;case"FocusLink":var a=e.queryResult.parameters.linkId;t.focusLink(a);break;case"FollowLink":a=e.queryResult.parameters.linkId;t.followLink(a);break;case"PageImages":t.getImages();break;case"FocusImage":var o=e.queryResult.parameters.imageId;t.focusImage(o);break;case"AllFormItems":t.getForms();break;case"DescribeItem":t.describeItem();break;case"ClickItem":t.clickItem();break;default:t.speak("Sorry, I could not understand that. Please try again!")}},error:function(){console.log("Internal Server Error")}})})),a(this,"focusLink",(function(e){document.links.item(e).focus()})),a(this,"focusImage",(function(e){document.images.item(e).focus()})),a(this,"clickItem",(function(){var e=document.activeElement,t=document.createEvent("Events");t.initEvent("keypress",!0,!0),t.keyCode=13,t.which=13,t.charCode=13,t.key="Enter",t.code="Enter",e.dispatchEvent(t)})),a(this,"describeItem",(function(){var e=document.activeElement,t=$(e).prop("tagName").toLowerCase(),n="";if("a"!=t)"li"==t?(n+="This is a list item ",0<$(e).text().length&&(n+=", it contains the text - "+$(e).text()+" ")):"img"==t?(n+="This is an image item ",0<$(e).prop("alt").length&&(n+=", it has an alternate text reading - "+$(e).prop("alt")+" ")):n+="This is an element of tag "+t;else if(n+="This is a link item ",0<$(e).text().length&&(n+=", it contains the text - "+$(e).text()+" "),n+="and points to "+$(e).prop("href")+".",0<$(e).children("img").length){n+=" It contains an image ";var a=$(e).children("img")[0];0<$(a).prop("alt").length&&(n+=", with an alternate text reading - "+$(a).prop("alt")+" ")}this.speak(n)})),a(this,"describePage",(function(){var e=this;e.speak("The title of this page is: "+document.title),e.speak("This page has "+e.linksList.length+" links, "+e.imageList.length+" images and "+e.formList.length+" forms on it."),e.pageSummary&&e.speak("We have a summary available for this page. You can listen to it by using the Page Summary voice command.")})),a(this,"readSummary",(function(){this.speak(this.pageSummary)})),a(this,"labels",(function(){var e=this;e.labelcounter=0,$.ajax({method:"POST",url:"https://568bd7cf.ngrok.io/api/labels",data:{pageBody:e.html},success:function(t){console.log(t);var n=t.data.changes;e.labelchanges=n;for(var a=0;a<n.length;a++){var o=n[a].xpath,i=n[a].changes;for(var r in i){var s=document.evaluate(o,document,null,XPathResult.ANY_UNORDERED_NODE_TYPE,null);try{var c=s.singleNodeValue.getAttribute(r);c&&0<c.length&&(e.labelchanges[a].changes=c),s.singleNodeValue.setAttribute(r,i[r]),s.singleNodeValue.setAttribute("change","label_"+e.labelcounter),e.labelchanges[a].element="label_"+e.labelcounter,e.labelcounter+=1}catch(e){console.log("Labels: "),console.log(o),console.log(e)}}}}})})),a(this,"captions",(function(){var e=this;e.captioncounter=0,$.ajax({method:"POST",url:"https://568bd7cf.ngrok.io/api/captions",data:{pageBody:e.html},success:function(t){console.log(t);var n=t.data.changes;e.captionchanges=n;for(var a=0;a<n.length;a++){var o=n[a].xpath,i=n[a].changes;for(var r in i){var s=document.evaluate(o,document,null,XPathResult.ANY_UNORDERED_NODE_TYPE,null);try{var c=s.singleNodeValue.getAttribute(r);c&&0<c.length&&(console.log("Previous value: "+c),e.captionchanges[a].changes=c),s.singleNodeValue.setAttribute(r,i[r]),s.singleNodeValue.setAttribute("change","caption_"+e.captioncounter),e.captionchanges[a].element="caption_"+e.captioncounter,e.captioncounter+=1}catch(e){console.log("captions"),console.log(o),console.log(e)}}}e.updateImageList()}})})),a(this,"displayLabels",(function(){for(var e=this.labelchanges,t=0;t<e.length;t++){var n=e[t].element,a=e[t].changes;for(var o in a){var i=document.querySelector("[change="+n+"]");try{var r=document.createElement("span");i.parentNode.insertBefore(r,i),r.style.background="red",r.appendChild(i);var s=document.createElement("span");s.style.color="white",s.innerHTML=a[o],r.appendChild(s)}catch(e){console.log("labels"),console.log(i),console.log(e)}}}})),a(this,"displayCaptions",(function(){for(var e=this.captionchanges,t=0;t<e.length;t++){var n=e[t].element,a=e[t].changes;for(var o in a){var i=document.querySelector("[change="+n+"]");try{var r=document.createElement("div");i.parentNode.insertBefore(r,i),r.style.background="black",r.appendChild(i);var s=document.createElement("div");s.style.color="white",s.innerHTML=i.getAttribute("aify-caption")+i.getAttribute("aify-ocr"),r.appendChild(s)}catch(e){console.log("captions"),console.log(i),console.log(e)}}}})),a(this,"speak",(function(e){console.log(e),speechSynthesis.speak(new SpeechSynthesisUtterance(e))})),a(this,"updateLinksList",(function(){this.linksList=[];for(var e=document.links,t=0;t<e.length;t++)e[t].setAttribute("linkid",t),console.log(e[t]),this.linksList.push(e[t])})),a(this,"getPageLinks",(function(){var e=this.linksList,t="";t+="The links on this page are - ";for(var n=0;n<e.length;n++)t+="Link number "+n+" - "+e[n].text+", ";this.speak(t)})),a(this,"followLink",(function(e){this.speak("Opening link number "+e),document.querySelector("[linkid='"+e+"']").click()})),a(this,"updateImageList",(function(){this.imageList=[];for(var e=document.images,t=0;t<e.length;t++)e[t].setAttribute("imgid",t),console.log(e[t]),this.imageList.push(e[t])})),a(this,"getImages",(function(){var e=this.imageList,t="";t+="The images on this page are - ";for(var n=0;n<e.length;n++)t+="Image number "+n+" - "+e[n].alt+", ";this.speak(t)})),a(this,"updateFormList",(function(){this.formList=[];for(var e=document.forms,t=0;t<e.length;t++)e[t].setAttribute("formid",t),console.log(e[t]),this.formList.push(e[t])})),a(this,"getForms",(function(){var e=this.formList,t="";t+="The forms on this page are - ";for(var n=0;n<e.length;n++)t+="Form number "+n+" - "+e[n].name+", ";this.speak(t)}));var n=window.$;window.jQuery;this.html=n("html").html(),this.linksList=[],this.imageList=[],this.formList=[],this.pageSummary=!1;var o=this,i=0;o.updateLinksList(),o.updateImageList(),o.updateFormList(),window.SpeechRecognition=window.webkitSpeechRecognition||window.SpeechRecognition;var r="",s=new window.SpeechRecognition;s.interimResults=!1,s.maxAlternatives=3,s.continuous=!0,s.onresult=function(e){for(var n,a=e.resultIndex,o=e.results.length;a<o;a++)n=e.results[a][0].transcript,e.results[a].isFinal?r+=n:n;console.log(r),t.goDialogFlow(r),r="",s.stop(),!1},n("body").dblclick((function(){1<++i?(console.log("Voice input started"),s.stop(),o.speak("Speak command: "),s.start(),!0):console.log("One more tap to activate chatbot...")}));var c=0,l=0;n(document).keydown((function(e){if(70==e.which){l++;var t=(new Date).getTime();t-c<500&&3==l?(c=0,l=0,console.log("Voice input started"),s.stop(),o.speak("Speak command: "),s.start(),!0):c=t}})),n.ajax({method:"POST",url:"https://568bd7cf.ngrok.io/api/check",success:function(e){console.log(e),"0"!=e.data.summary&&(o.pageSummary=e.data.summary)}})},t.default=aifyjs},function(e,t,n){var a=n(2);"string"==typeof a&&(a=[[e.i,a,""]]);var o={insert:"head",singleton:!1};n(4)(a,o);a.locals&&(e.exports=a.locals)},function(e,t,n){(e.exports=n(3)(!1)).push([e.i,"*:focus {\n  box-shadow: 0 0 5px rgba(81, 203, 238, 1);\n  padding: 3px 0px 3px 3px;\n  margin: 5px 1px 3px 0px;\n  border: 1px solid rgba(81, 203, 238, 1);\n}\n",""])},function(e,t,n){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n=function(e,t){var n=e[1]||"",a=e[3];if(!a)return n;if(t&&"function"==typeof btoa){var o=(r=a,s=btoa(unescape(encodeURIComponent(JSON.stringify(r)))),c="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(s),"/*# ".concat(c," */")),i=a.sources.map((function(e){return"/*# sourceURL=".concat(a.sourceRoot).concat(e," */")}));return[n].concat(i).concat([o]).join("\n")}var r,s,c;return[n].join("\n")}(t,e);return t[2]?"@media ".concat(t[2],"{").concat(n,"}"):n})).join("")},t.i=function(e,n){"string"==typeof e&&(e=[[null,e,""]]);for(var a={},o=0;o<this.length;o++){var i=this[o][0];null!=i&&(a[i]=!0)}for(var r=0;r<e.length;r++){var s=e[r];null!=s[0]&&a[s[0]]||(n&&!s[2]?s[2]=n:n&&(s[2]="(".concat(s[2],") and (").concat(n,")")),t.push(s))}},t}},function(e,t,n){"use strict";var a,o={},i=function(){return void 0===a&&(a=Boolean(window&&document&&document.all&&!window.atob)),a},r=function(){var e={};return function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}e[t]=n}return e[t]}}();function s(e,t){for(var n=[],a={},o=0;o<e.length;o++){var i=e[o],r=t.base?i[0]+t.base:i[0],s={css:i[1],media:i[2],sourceMap:i[3]};a[r]?a[r].parts.push(s):n.push(a[r]={id:r,parts:[s]})}return n}function c(e,t){for(var n=0;n<e.length;n++){var a=e[n],i=o[a.id],r=0;if(i){for(i.refs++;r<i.parts.length;r++)i.parts[r](a.parts[r]);for(;r<a.parts.length;r++)i.parts.push(m(a.parts[r],t))}else{for(var s=[];r<a.parts.length;r++)s.push(m(a.parts[r],t));o[a.id]={id:a.id,refs:1,parts:s}}}}function l(e){var t=document.createElement("style");if(void 0===e.attributes.nonce){var a=n.nc;a&&(e.attributes.nonce=a)}if(Object.keys(e.attributes).forEach((function(n){t.setAttribute(n,e.attributes[n])})),"function"==typeof e.insert)e.insert(t);else{var o=r(e.insert||"head");if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(t)}return t}var u,h=(u=[],function(e,t){return u[e]=t,u.filter(Boolean).join("\n")});function p(e,t,n,a){var o=n?"":a.css;if(e.styleSheet)e.styleSheet.cssText=h(t,o);else{var i=document.createTextNode(o),r=e.childNodes;r[t]&&e.removeChild(r[t]),r.length?e.insertBefore(i,r[t]):e.appendChild(i)}}function f(e,t,n){var a=n.css,o=n.media,i=n.sourceMap;if(o&&e.setAttribute("media",o),i&&btoa&&(a+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(i))))," */")),e.styleSheet)e.styleSheet.cssText=a;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(a))}}var d=null,g=0;function m(e,t){var n,a,o;if(t.singleton){var i=g++;n=d||(d=l(t)),a=p.bind(null,n,i,!1),o=p.bind(null,n,i,!0)}else n=l(t),a=f.bind(null,n,t),o=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(n)};return a(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;a(e=t)}else o()}}e.exports=function(e,t){(t=t||{}).attributes="object"==typeof t.attributes?t.attributes:{},t.singleton||"boolean"==typeof t.singleton||(t.singleton=i());var n=s(e,t);return c(n,t),function(e){for(var a=[],i=0;i<n.length;i++){var r=n[i],l=o[r.id];l&&(l.refs--,a.push(l))}e&&c(s(e,t),t);for(var u=0;u<a.length;u++){var h=a[u];if(0===h.refs){for(var p=0;p<h.parts.length;p++)h.parts[p]();delete o[h.id]}}}}}])}));